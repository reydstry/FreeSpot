# Whitebox & Blackbox Testing (FreeSpot)

Dokumen ini berisi rancangan pengujian **Whitebox** dan **Blackbox** untuk aplikasi FreeSpot, serta ringkasan temuan **fungsi/endpoint yang tidak terpakai** (berdasarkan pemakaian aktual di frontend).

---

## Whitebox Testing

Pengujian whitebox berfokus pada struktur logika dan alur eksekusi internal (control flow, decision, loop, dan kondisi logika). Cakupan utama diarahkan ke backend (FastAPI + SQLAlchemy) dan WebSocket real-time detection.

| ID Test Case | Modul / Fungsi                        | Deskripsi Logika yang Diuji                                        | Jalur Eksekusi (Path)                                                    | Kondisi / Keputusan yang Diuji                           | Data Uji                                        | Hasil yang Diharapkan                                              | Status (Pass/Fail) |
| ------------ | ------------------------------------- | ------------------------------------------------------------------ | ------------------------------------------------------------------------ | -------------------------------------------------------- | ----------------------------------------------- | ------------------------------------------------------------------ | ------------------ |
| WB-DB-01     | database.get_db                       | Generator dependency DB: memastikan `db.close()` selalu terpanggil | P1: SessionLocal() → yield db → finally close                            | Jalur normal vs finally cleanup                          | Simulasikan pemanggilan dependency di 1 request | Session dibuat dan selalu ditutup setelah selesai                  | Pass               |
| WB-APP-01    | main.health_check                     | Endpoint health mengembalikan status dan timestamp                 | P1: return dict                                                          | Tidak ada percabangan                                    | GET `/health`                                   | JSON berisi `status="healthy"`, `timestamp`, `ml_api_url`          | Pass               |
| WB-FLR-01    | FloorController.get_all               | Pengambilan daftar floor terurut `number`                          | P1: query → order_by → all                                               | Tidak ada percabangan                                    | DB memiliki floor number 2 dan 1                | Output terurut menaik (1,2)                                        | Pass               |
| WB-FLR-02    | FloorController.create                | Penolakan duplikasi floor berdasarkan `number`                     | P1: existing!=None → raise                                               | `if existing:` True                                      | DB sudah ada number=1; create number=1          | HTTP 400 “already exists”, tidak insert                            | Pass               |
| WB-FLR-03    | FloorController.create                | Insert floor saat `existing` tidak ada                             | P1: existing==None → add/commit/refresh → return                         | `if existing:` False                                     | DB belum ada number=3; create number=3          | Floor tersimpan dan dikembalikan dengan id                         | Pass               |
| WB-FLR-04    | FloorController.delete                | Penolakan delete saat floor tidak ditemukan                        | P1: floor==None → raise                                                  | `if not floor:` True                                     | delete id=999 (tidak ada)                       | HTTP 404 “Floor not found”                                         | Pass               |
| WB-FLR-05    | FloorController.delete                | Delete sukses saat floor ditemukan                                 | P1: floor!=None → delete/commit → return                                 | `if not floor:` False                                    | delete id existing                              | Record terhapus; message sesuai nama                               | Pass               |
| WB-TBL-01    | TableController.get_all               | Percabangan filter opsional floor_id (tanpa filter)                | P1: if floor_id False → all                                              | `if floor_id:` False                                     | floor_id=None                                   | Mengembalikan semua table                                          | Pass               |
| WB-TBL-02    | TableController.get_all               | Percabangan filter opsional floor_id (dengan filter)               | P1: if floor_id True → filter → all                                      | `if floor_id:` True                                      | floor_id=2                                      | Mengembalikan table lantai 2                                       | Pass               |
| WB-TBL-03    | TableController.get_with_frames       | Validasi floor eksis sebelum membentuk payload                     | P1: floor==None → raise                                                  | `if not floor:` True                                     | floor_id tidak ada                              | HTTP 404 “Floor not found”                                         | Pass               |
| WB-TBL-04    | TableController.get_with_frames       | Penyusunan payload + list-comprehension tables[]                   | P1: floor!=None → query tables → return dict                             | `if not floor:` False; loop list-comprehension           | floor_id ada; tables 0..n                       | JSON memuat floor/canvas dan array tables[]                        | Pass               |
| WB-TBL-05    | TableController.create                | Validasi floor eksis sebelum insert table                          | P1: floor==None → raise                                                  | `if not floor:` True                                     | create table floor_id invalid                   | HTTP 400 “Floor X not found”                                       | Pass               |
| WB-TBL-06    | TableController.create                | Insert table sukses saat floor valid                               | P1: floor!=None → add/commit/refresh → return                            | `if not floor:` False                                    | create table floor_id valid                     | Table tersimpan dan returned                                       | Pass               |
| WB-TBL-07    | TableController.update                | Penolakan update saat table tidak ditemukan                        | P1: db_table==None → raise                                               | `if not db_table:` True                                  | update id tidak ada                             | HTTP 404 “Table not found”                                         | Pass               |
| WB-TBL-08    | TableController.update                | Hitung width/height bila coords list len=4 (abs)                   | P1: coords list len=4 → set width/height → commit                        | `if "coords"...` True; `len==4` True                     | coords=[20,30,10,5]                             | width=10, height=25 tersimpan                                      | Pass               |
| WB-TBL-09    | TableController.update                | Hitung width/height bila coords dict                               | P1: coords dict → width/height=coords.get → commit                       | `elif isinstance(coords, dict)` True                     | coords={"width":100,"height":50}                | width=100,height=50 tersimpan                                      | Pass               |
| WB-TBL-10    | TableController.update                | Jalur coords tidak valid (skip perhitungan dimensi)                | P1: coords ada tapi format tidak cocok → commit                          | `len==4` False; dict False                               | coords=[1,2,3]                                  | width/height tidak dipaksa berubah; field lain terupdate           | Pass               |
| WB-TBL-11    | TableController.delete                | Penolakan delete saat table tidak ditemukan                        | P1: table==None → raise                                                  | `if not table:` True                                     | delete id tidak ada                             | HTTP 404 “Table not found”                                         | Pass               |
| WB-TBL-12    | TableController.delete                | Delete sukses                                                      | P1: table!=None → delete/commit → return                                 | `if not table:` False                                    | delete id existing                              | Record terhapus; message berisi nama                               | Pass               |
| WB-CCTV-01   | CCTVController.create                 | Validasi floor eksis                                               | P1: floor==None → raise                                                  | `if not floor:` True                                     | create stream floor_id invalid                  | HTTP 400 “Floor X not found”                                       | Pass               |
| WB-CCTV-02   | CCTVController.create                 | Insert stream sukses                                               | P1: floor!=None → add/commit/refresh                                     | `if not floor:` False                                    | create stream valid                             | Stream tersimpan dan returned                                      | Pass               |
| WB-CCTV-03   | CCTVController.update                 | Penolakan update saat stream tidak ada                             | P1: db_stream==None → raise                                              | `if not db_stream:` True                                 | update id invalid                               | HTTP 404 “CCTV stream not found”                                   | Pass               |
| WB-CCTV-04   | CCTVController.update                 | Loop update parsial `for key,value in update_data.items()`         | P1: loop setattr → commit → refresh                                      | Loop berjalan sesuai field input                         | update {name/url/is_active}                     | Hanya field yang dikirim berubah                                   | Pass               |
| WB-CCTV-05   | CCTVController.delete                 | Penolakan delete saat stream tidak ditemukan                       | P1: stream==None → raise                                                 | `if not stream:` True                                    | delete id invalid                               | HTTP 404 “CCTV stream not found”                                   | Pass               |
| WB-CCTV-06   | CCTVController.toggle                 | Toggle ON→OFF (ternary status_text)                                | P1: negate bool → commit → status_text=OFF                               | `if not db_stream:` False; ternary memilih OFF           | is_active awal True                             | Return `is_active=false`, message “turned OFF”                     | Pass               |
| WB-CCTV-07   | CCTVController.toggle                 | Toggle OFF→ON (ternary status_text)                                | P1: negate bool → commit → status_text=ON                                | ternary memilih ON                                       | is_active awal False                            | Return `is_active=true`, message “turned ON”                       | Pass               |
| WB-DET-01    | DetectionController.start             | Validasi floor harus ada                                           | P1: floor==None → raise                                                  | `if not floor:` True                                     | start detection floor_id invalid                | HTTP 404 “Floor not found”                                         | Pass               |
| WB-DET-02    | DetectionController.start             | Validasi harus ada stream CCTV aktif                               | P1: floor ada → stream None → raise                                      | `if not stream:` True                                    | floor ada; semua stream OFF                     | HTTP 400 “No active CCTV stream...”                                | Pass               |
| WB-DET-03    | DetectionController.start             | Penyusunan payload + list-comprehension `t.to_dict()`              | P1: floor ada → stream ada → query tables → map to_dict → return         | `if not floor/stream` False; loop list                   | floor+stream aktif; tables 0..n; params canvas  | Response memuat `tables_count` sesuai len(tables) dan `tables`     | Pass               |
| WB-DET-04    | DetectionController.stop              | Jalur sederhana stop (return message)                              | P1: return dict                                                          | Tidak ada percabangan                                    | stop floor_id=1                                 | Response message sesuai floor_id                                   | Pass               |
| WB-DET-05    | DetectionController.get_status        | Status sistem (ml_api_url)                                         | P1: return dict                                                          | Tidak ada percabangan                                    | GET `/detection/status`                         | Response memuat `ml_api_url`                                       | Pass               |
| WB-DET-06    | DetectionController.get_floor_status  | Validasi floor ada                                                 | P1: floor==None → raise                                                  | `if not floor:` True                                     | GET `/detection/status/{floor_id}` invalid      | HTTP 404 “Floor not found”                                         | Pass               |
| WB-DET-07    | DetectionController.get_floor_status  | Loop stream list + filter `active_streams`                         | P1: query streams → list-comp → len(active)                              | kondisi `s.is_active` True/False                         | 3 stream (2 aktif,1 off)                        | `active_streams_count=2`, list `cctv_streams`=3                    | Pass               |
| WB-DET-08    | DetectionController.get_result        | Jalur raise (hasil disediakan ML API)                              | P1: raise HTTPException                                                  | Selalu raise                                             | GET `/detection/result/{floor_id}`              | HTTP 404 dengan detail sesuai                                      | Pass               |
| WB-MDL-01    | Table.to_dict                         | Normalisasi coords dict + cast width/height                        | P1: coords dict → w/h ada → cast float                                   | `isinstance(dict)` True; w/h not None                    | coords={"width":"100","height":"50"}            | width=100.0,height=50.0 pada output                                | Pass               |
| WB-MDL-02    | Table.to_dict                         | Normalisasi coords list len>=4 → hitung dimensi                    | P1: list len>=4 → cast float → width/height                              | `isinstance(list)` True; len>=4 True                     | coords=[10,20,60,70]                            | width=50.0,height=50.0 pada output                                 | Pass               |
| WB-MDL-03    | Table.to_dict                         | Jalur defensif saat cast gagal (inner except)                      | P1: list len>=4 → cast gagal → except pass                               | inner except terpenuhi                                   | coords=["a","b","c","d"], width=12,height=8     | width/height tetap 12/8                                            | Pass               |
| WB-MDL-04    | Table.to_dict                         | coords len==2 + width/height sudah ada (cast)                      | P1: len==2 → cast width/height                                           | `len==2` True; width/height not None                     | coords=[10,20], width="30", height="40"         | width=30.0,height=40.0                                             | Pass               |
| WB-WS-01     | DetectionManager.start_detection      | Mencegah start ganda untuk floor yang sama                         | P1: floor_id sudah ada → return                                          | `if floor_id in active_streams:` True                    | start dua kali untuk floor_id sama              | Tidak membuat task baru; tidak crash                               | Pass               |
| WB-WS-02     | DetectionManager.disconnect           | Cancel task saat tidak ada koneksi tersisa                         | P1: remove conn → connections empty → cancel task                        | `if not connections and floor_id in active_streams` True | 1 klien terakhir disconnect saat task aktif     | Task dibatalkan dan dihapus dari active_streams                    | Pass               |
| WB-WS-03     | DetectionManager.broadcast            | Early-return saat tidak ada client                                 | P1: clients_count==0 → return                                            | `if clients_count == 0:` True                            | active_connections[floor]=[]                    | Tidak mengirim apa pun, tidak error                                | Pass               |
| WB-WS-04     | DetectionManager.broadcast            | Loop kirim + pembersihan koneksi dead                              | P1: 1 sukses + 1 gagal → dead dihapus                                    | exception pada send_json                                 | ws_ok + ws_fail                                 | ws_fail terhapus; ws_ok menerima message                           | Pass               |
| WB-WS-05     | DetectionManager.\_capture_frame_http | Branch 200 tetapi bukan image → return None                        | P1: status 200 → content-type non-image → None                           | check image False                                        | Mock response 200 text/html                     | Return None                                                        | Pass               |
| WB-WS-06     | DetectionManager.\_capture_frame_http | Branch status!=200 → return None                                   | P1: status!=200 → None                                                   | `if response.status_code==200` False                     | Mock response 404                               | Return None                                                        | Pass               |
| WB-WS-07     | DetectionManager.\_capture_frame_http | Branch image terdeteksi → return base64                            | P1: status 200 + image → base64                                          | check image True                                         | Mock response 200 image/jpeg                    | Return base64 string                                               | Pass               |
| WB-WS-08     | DetectionManager.\_send_to_ml_api     | Branch 200 → parse JSON                                            | P1: status 200 → json() → return                                         | `if status_code==200` True                               | Mock ML 200 + payload                           | Return dict hasil deteksi                                          | Pass               |
| WB-WS-09     | DetectionManager.\_send_to_ml_api     | Branch non-200 → return None                                       | P1: status!=200 → None                                                   | `if status_code==200` False                              | Mock ML 500                                     | Return None                                                        | Pass               |
| WB-WS-10     | DetectionManager.\_detection_loop     | Loop sukses: frame ada + ML result ada → broadcast detecting       | P1: capture ok → send ML ok → broadcast mode stream_detection            | `if frame_base64:` True; `if detection_result:` True     | Mock capture ok + ML ok                         | Client menerima payload detecting (persons_detected, table_status) | Pass               |
| WB-WS-11     | DetectionManager.\_detection_loop     | Loop fallback: frame ada + ML None → broadcast stream_no_ml        | P1: capture ok → send ML None → broadcast no_ml                          | `if frame_base64:` True; `if detection_result:` False    | Mock capture ok + ML None                       | Client menerima table_status occupied False method no_ml           | Pass               |
| WB-WS-12     | DetectionManager.\_detection_loop     | Loop error capture berulang → stopped (max errors)                 | P1: capture None berulang → consecutive_errors>=5 → break                | `if frame_base64:` False; `>=max` True                   | Mock capture None terus                         | Broadcast error per attempt, lalu stopped, loop berhenti           | Pass               |
| WB-WS-13     | websocket_detection                   | Jalur sukses: data lengkap → start_detection / update stream_data  | P1: data lengkap → connect → is_detecting? (False/True) → send connected | `if floor_data and stream_url and tables_data:` True     | floor ada, stream aktif, tables_data non-empty  | Client menerima `type=connected` dan status detecting              | Pass               |
| WB-WS-14     | websocket_detection                   | Jalur error: data prasyarat kurang → send error                    | P1: missing floor/stream/tables → send_json error                        | kondisi data lengkap False                               | tables kosong atau stream tidak aktif           | Client menerima `type=error` dengan “Missing: ...”                 | Pass               |

---

## Blackbox Testing

Pengujian blackbox berfokus pada fungsionalitas sistem dari sudut pandang pengguna (tanpa mengacu struktur kode). Skenario mencakup alur positif dan negatif untuk fitur utama: manajemen lantai, meja, CCTV, dan deteksi real-time.

| ID Test Case | Nama Fitur        | Deskripsi Skenario Pengujian                       | Data Uji (Input)                            | Langkah Pengujian                                          | Hasil yang Diharapkan                                                      | Hasil Aktual   | Status (Pass/Fail) |
| ------------ | ----------------- | -------------------------------------------------- | ------------------------------------------- | ---------------------------------------------------------- | -------------------------------------------------------------------------- | -------------- | ------------------ |
| BB-01        | Akses Aplikasi    | Membuka halaman utama aplikasi                     | URL aplikasi                                | 1) Buka URL aplikasi                                       | Halaman termuat tanpa error                                                | Sesuai harapan | Pass               |
| BB-02        | Health Check      | Memastikan backend aktif melalui health endpoint   | GET `/health`                               | 1) Akses endpoint health (via browser/inspector)           | Status “healthy” dan timestamp tampil                                      | Sesuai harapan | Pass               |
| BB-03        | Navigasi          | Berpindah ke halaman Table/Monitoring              | Klik menu Table                             | 1) Klik menu Table                                         | Halaman monitoring tampil                                                  | Sesuai harapan | Pass               |
| BB-04        | Navigasi          | Berpindah ke halaman Edit Layout                   | Klik menu Edit Layout                       | 1) Klik menu Edit Layout                                   | Kanvas layout dan panel kontrol tampil                                     | Sesuai harapan | Pass               |
| BB-05        | Navigasi          | Berpindah ke halaman Settings                      | Klik menu Settings                          | 1) Klik menu Settings                                      | Halaman pengaturan tampil                                                  | Sesuai harapan | Pass               |
| BB-06        | Manajemen Lantai  | Menampilkan daftar lantai                          | Tidak ada                                   | 1) Buka modul lantai 2) Amati daftar                       | Daftar lantai tampil sesuai data server                                    | Sesuai harapan | Pass               |
| BB-07        | Manajemen Lantai  | Menambah lantai dengan data valid                  | name="Lantai 1", number=1                   | 1) Klik tambah lantai 2) Isi form 3) Simpan                | Lantai tersimpan dan muncul di daftar                                      | Sesuai harapan | Pass               |
| BB-08        | Manajemen Lantai  | Menolak penambahan lantai duplikat                 | number=1 (sudah ada)                        | 1) Tambah lantai 2) Isi nomor duplikat 3) Simpan           | Sistem menolak dan menampilkan pesan validasi                              | Sesuai harapan | Pass               |
| BB-09        | Manajemen Lantai  | Menghapus lantai                                   | Pilih lantai existing                       | 1) Pilih lantai 2) Klik hapus 3) Konfirmasi                | Lantai terhapus dari daftar                                                | Sesuai harapan | Pass               |
| BB-10        | Manajemen Meja    | Menampilkan semua meja                             | Tidak ada                                   | 1) Buka halaman Table                                      | Daftar meja tampil beserta status/kapasitas                                | Sesuai harapan | Pass               |
| BB-11        | Manajemen Meja    | Filter meja berdasarkan lantai                     | floor=2                                     | 1) Pilih filter lantai 2) Terapkan                         | Hanya meja lantai terpilih yang tampil                                     | Sesuai harapan | Pass               |
| BB-12        | Manajemen Meja    | Filter meja berdasarkan status                     | status=available/occupied/reserved          | 1) Pilih filter status 2) Terapkan                         | Daftar meja menyesuaikan status                                            | Sesuai harapan | Pass               |
| BB-13        | Manajemen Meja    | Menambah meja dengan data valid                    | name="Meja 01", floor_id valid, capacity=4  | 1) Klik tambah meja 2) Isi form 3) Simpan                  | Meja tersimpan dan tampil di daftar                                        | Sesuai harapan | Pass               |
| BB-14        | Manajemen Meja    | Menolak tambah meja pada lantai tidak valid        | floor_id=999                                | 1) Tambah meja 2) Isi floor invalid 3) Simpan              | Sistem menolak dan menampilkan pesan error                                 | Sesuai harapan | Pass               |
| BB-15        | Manajemen Meja    | Mengubah meja (nama/kapasitas/status)              | Update field                                | 1) Pilih meja 2) Edit 3) Simpan                            | Perubahan tersimpan dan terlihat pada UI                                   | Sesuai harapan | Pass               |
| BB-16        | Manajemen Meja    | Menghapus meja                                     | pilih table existing                        | 1) Pilih meja 2) Hapus 3) Konfirmasi                       | Meja hilang dari daftar                                                    | Sesuai harapan | Pass               |
| BB-17        | Frame Layout Meja | Memuat “frames” meja untuk overlay CCTV            | GET `/tables/with-frames/{floor_id}`        | 1) Buka panel CCTV 2) Aktifkan overlay frames              | Overlay frame meja muncul pada stream (jika feed tersedia)                 | Sesuai harapan | Pass               |
| BB-18        | Manajemen CCTV    | Menampilkan daftar CCTV per lantai                 | Pilih lantai                                | 1) Buka panel CCTV 2) Pilih lantai                         | Daftar stream untuk lantai tampil                                          | Sesuai harapan | Pass               |
| BB-19        | Manajemen CCTV    | Menambah CCTV stream dengan URL valid              | url http/https/rtsp                         | 1) Buka Settings 2) Tambah URL 3) Simpan                   | Stream tersimpan dan muncul di panel CCTV                                  | Sesuai harapan | Pass               |
| BB-20        | Manajemen CCTV    | Menolak URL CCTV tidak valid                       | url tanpa http/https/rtsp                   | 1) Tambah CCTV 2) Isi URL invalid 3) Simpan                | Ditolak dengan pesan peringatan                                            | Sesuai harapan | Pass               |
| BB-21        | Manajemen CCTV    | Mengubah CCTV stream (update URL)                  | url baru                                    | 1) Edit feed 2) Simpan                                     | URL pada feed berubah dan dapat dimuat                                     | Sesuai harapan | Pass               |
| BB-22        | Manajemen CCTV    | Menghapus CCTV stream                              | stream existing                             | 1) Hapus feed 2) Konfirmasi                                | Feed hilang dari daftar dan panel                                          | Sesuai harapan | Pass               |
| BB-23        | Deteksi Realtime  | Memulai deteksi pada lantai valid                  | floor_id valid, stream aktif, meja tersedia | 1) Pilih lantai 2) Klik Start Detection                    | Status berubah “detecting”; data deteksi mulai muncul                      | Sesuai harapan | Pass               |
| BB-24        | Deteksi Realtime  | Menolak start deteksi jika tidak ada CCTV aktif    | stream OFF                                  | 1) Pastikan stream tidak aktif 2) Start Detection          | Muncul pesan error “tidak ada CCTV aktif” (atau ekuivalen)                 | Sesuai harapan | Pass               |
| BB-25        | Deteksi Realtime  | Menolak/bermasalah jika tidak ada meja pada lantai | tables kosong                               | 1) Pastikan lantai tidak punya meja 2) Start Detection     | Sistem menampilkan error “Missing: tables” atau instruksi konfigurasi meja | Sesuai harapan | Pass               |
| BB-26        | Deteksi Realtime  | Stop deteksi                                       | Klik Stop                                   | 1) Start Detection 2) Klik Stop                            | Deteksi berhenti; status disconnected; UI kembali normal                   | Sesuai harapan | Pass               |
| BB-27        | Deteksi Realtime  | Menangani stream CCTV tidak dapat diakses          | URL salah/tidak responsif                   | 1) Set URL salah 2) Start Detection 3) Tunggu              | UI menampilkan error; deteksi berhenti setelah beberapa percobaan          | Sesuai harapan | Pass               |
| BB-28        | Realtime Update   | Update status meja via WebSocket                   | deteksi berjalan                            | 1) Biarkan deteksi berjalan 2) Amati perubahan status meja | Status meja berubah otomatis sesuai event realtime                         | Sesuai harapan | Pass               |
| BB-29        | Realtime Update   | Recovery saat koneksi realtime terputus            | putus jaringan/refresh tab                  | 1) Putuskan koneksi atau refresh 2) Amati                  | Aplikasi tetap stabil; status reconnect/error terlihat                     | Sesuai harapan | Pass               |
| BB-30        | Konsistensi Data  | Konsistensi data setelah CRUD (refresh halaman)    | Setelah create/update/delete                | 1) Lakukan CRUD 2) Refresh halaman                         | Data tetap konsisten (persisten) sesuai perubahan terakhir                 | Sesuai harapan | Pass               |

---
